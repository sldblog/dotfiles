#!/bin/bash

DOTFILES="$(cd $(dirname $0)/.. && pwd)"
UNAME="$(uname)"

function symlink_files {
  for file in .zshenv .zshrc .gemrc .gitconfig .vimrc .agignore .iex.exs; do
    ln -si $DOTFILES/$file $HOME/$file && echo "$HOME/$file linked"
  done

  mkdir -p $HOME/.gnupg && chmod 700 $HOME/.gnupg
  ln -si $DOTFILES/gpg-agent.conf "$HOME/.gnupg/gpg-agent.conf"

  mkdir -p $HOME/.lein
  ln -si lein-profiles.clj $HOME/.lein/profiles.clj && echo "$HOME/.lein/profiles.clj linked"

  local vscode_settings_location=""
  if [ "$UNAME" == "Linux" ]; then
    vscode_settings_location="$HOME/.config/Code - OSS/User/settings.json"
  else
    vscode_settings_location="$HOME/Library/Application Support/Code/User/settings.json"
  fi
  ln -si $DOTFILES/vscode.user-settings.json "$vscode_settings_location"
}

function install_dependencies {
  if [ "$UNAME" == "Linux" ]; then
    local packages=$(tr '\n' ' ' < $DOTFILES/Pacman-packages)
    sudo pacman --sync --refresh
    sudo pacman --sync --needed --noconfirm $packages
  else
    brew bundle --file=$DOTFILES/Brewfile
  fi
  pip install --upgrade --requirement $DOTFILES/Pipfile
}

function install_zsh_addons {
  theme_file="$HOME/.oh-my-zsh/themes/bullet-train.zsh-theme"
  rm -f $theme_file
  curl --silent https://raw.githubusercontent.com/caiogondim/bullet-train-oh-my-zsh-theme/master/bullet-train.zsh-theme \
    -o $theme_file && echo "zsh theme $(basename $theme_file) installed"
}

function install_vim_addons {
  mkdir -p $HOME/.vim/bundle/
  git clone https://github.com/VundleVim/Vundle.vim.git $HOME/.vim/bundle/Vundle.vim
  vim +PluginInstall +qall && echo "vim plugins installed"
}

symlink_files
install_dependencies
install_vim_addons
install_zsh_addons
